<h1>24: The Long Game</h1>

<a href="https://www.codingame.com/training/hard/24-the-long-game">https://www.codingame.com/training/hard/24-the-long-game</a>

<div class="statement-body">
<div class="statement-section statement-goal">
   <h2><span class="icon icon-goal">&nbsp;</span><span>Goal </span></h2>
   <span class="question-statement">In the 24 Game, a given set of four numbers must be combined using only the arithmetic operations <const>+ - &times; &divide;</const> with parentheses <const>( )</const> if necessary to define the order in which operations are carried out. All four numbers must be used so that the end result is 24. The given numbers may be rearranged in any order; that is, the original order need not be followed. Normally, one solution is enough - if you prefer that, you can solve the following puzzle:<br><br>https://www.codingame.com/training/medium/24-game by @Smelty<br><br>For this puzzle, your program must provide the number of possible solutions (<var>ns</var>) and all those possible solutions, or <const>not possible</const> if there are no solutions.<br><br>Solutions must be printed as expressions without spaces, for example <const>3*(2*7-6)</const>. Only unique solutions should be included in the output. This requires rewriting expressions in a consistent way. <br><br><strong>EXPRESSIONS, TERMS AND SUBEXPRESSIONS</strong><br>To understand the rules for rewriting expressions, we must distinguish <strong>expressions, terms and subexpressions</strong>.<br><br><strong>expression:</strong> Terms separated by mathematical operators that can be evaluated from left to right. For example: <const>1+2+3+18</const>, <const>3*2*1*4</const>, <const>24+10-6-4</const>, <const>24/1/1/1</const> or <const>2*3*40/10</const>. <br><br><strong>term:</strong> A constant or a subexpression. The expression <const>3+7*(1+2)</const> has two terms. The first term is the constant <const>3</const>. The second term is the subexpression <const>7*(1+2)</const> - which itself also consists of one constant <const>7</const> and one subexpression <const>(1+2)</const>.<br><br><strong>subexpression:</strong> A subexpression is an expression that must be evaluated before the parent expression can be evaluated. The expression <const>(1+2)*(9-1)</const> consists of two terms, both of which are subexpressions: <const>(1+2)</const> and <const>(9-1)</const>. The expression <const>20+6/3+2</const> consists of three terms, of which one is a subexpression: <const>6/3</const> (the other two terms are the constants <const>20</const> and <const>2</const>).<br><br><strong>REWRITING EXPRESSIONS</strong><br><strong>Only rewrite an expression such that it remains mathematically the same.</strong><br>Rewrite expressions according to the following three rules:<br><br><strong>1. Use as few parentheses as possible.</strong><br>- Remove unnecessary parentheses: <const>(1*2)*3*4</const>&rarr;<const>1*2*3*4</const><br>- Rewrite an expression, if necessary: <const>9+18-(2+1)</const>&rarr;<const>9+18-2-1</const>, <const>12/(3/(2+4))</const>&rarr;<const>12*(2+4)/3</const><br>	<br><strong>2. Sort operators: <const>+</const> before <const>-</const> and <const>*</const> before <const>/</const>.</strong><br>- Change the order of terms such that for their connecting operators <const>+</const> comes before <const>-</const>, and <const>*</const> comes before <const>/</const><br>- Do this within a parent expression: <const>8-3+9+10</const>&rarr;<const>8+9+10-3</const>, <const>2/3*6*6</const>&rarr;<const>2*6*6/3</const>, <const>8-2+3*6</const>&rarr;<const>8+3*6-2</const><br>- Do this within a subexpression: <const>3*(5-4+7)</const>&rarr;<const>3*(5+7-4)</const>, <const>8+6/3*8</const>&rarr;<const>8+6*8/3</const><br>- This does not apply to operators in two different subexpressions: in <const>(3-1)*(5+7)</const>, the <const>-</const> and <const>+</const> are not part of the same subexpression, so their order is not decided by this rule (instead, use rule 3c for this case).<br><br><strong>3. For cases not decided by rule 2, sort terms of expressions and subexpressions</strong><br><strong> a)</strong> Sort constants in ascending order: <const>3*(16-5-3)</const>&rarr;<const>3*(16-3-5)</const>, <const>4+5*4*1</const>&rarr;<const>4+1*4*5</const>, <const>25-10/5/2</const>&rarr;<const>25-10/2/5</const><br><strong> b)</strong> Place constants before subexpressions: <const>(16-3-5)*3</const>&rarr;<const>3*(16-3-5)</const>, <const>5*8/4+14</const>&rarr;<const>14+5*8/4</const><br><strong> c)</strong> Sort two subexpressions according to their numerical value: <const>4*5+1*4</const>&rarr;<const>1*4+4*5</const> (1*4 &lt; 4*5), <const>(5+7)*(3-1)</const>&rarr;<const>(3-1)*(5+7)</const> (3-1 &lt; 5+7)<br>In the case of equal value, sort the subexpressions as strings, based on the ASCII value of characters: <const>48/4+3*4</const>&rarr;<const>3*4+48/4</const> ('3*4' &lt; '48/4')<br><br><strong>EXAMPLE</strong><br>With values 2,2,3,5, there are 8 non-unique solutions, but after applying above described rules, only one unique solution remains.<br><const>(2*5-2)*3</const>&rarr;<const>3*(2*5-2)</const> [<strong>rule 3b</strong>]<br><const>(5*2-2)*3</const>&rarr;<const>3*(2*5-2)</const> [<strong>rule 3a</strong> and <strong>rule 3b</strong>]<br><const>3*(2*5-2)</const><br><const>3*(5*2-2)</const>&rarr;<const>3*(2*5-2)</const> [<strong>rule 3a</strong>]<br><const>((2*5)-2)*3</const>&rarr;<const>3*(2*5-2)</const> [<strong>rule 1</strong> and <strong>rule 3b</strong>]<br><const>((5*2)-2)*3</const>&rarr;<const>3*(2*5-2)</const> [<strong>rule 1</strong>, <strong>rule 3a</strong>, <strong>rule 3b</strong>]<br><const>3*((2*5)-2)</const>&rarr;<const>3*(2*5-2)</const> [<strong>rule 1</strong>]<br><const>3*((5*2)-2)</const>&rarr;<const>3*(2*5-2)</const> [<strong>rule 1</strong> and <strong>rule 3a</strong>]<br><br><strong>SORTING MULTIPLE UNIQUE SOLUTIONS</strong><br>After applying above rules, you might still end up with multiple solutions. Output them in the following order:<br>- Solutions without parentheses ( <const>a+b+c+d</const> )<br>- Solutions with one set of parentheses ( <const>a*b*(c+d)</const> )<br>- Solutions with two sets of parentheses ( <const>(a+b)*(c+d)</const> )<br>Multiple solutions within the same category should be sorted as strings, based on the ASCII value of the characters.<br><br><strong>Credits to</strong> @<strong>Timinator for co-authoring the goal statement and some of the test cases</strong></span>
</div>
<div class="statement-section statement-protocol">
   <div class="blk">
      <div class="title">Input</div>
      <div class="question-statement-input"><strong>Line 1:</strong> four space separated integers <var>a</var>, <var>b</var>, <var>c</var>, <var>d</var></div>
   </div>
   <div class="blk">
      <div class="title">Output</div>
      <div class="question-statement-output"><strong>Line 1:</strong> <const>not possible</const> or number of unique solutions (<var>ns</var>)<br><strong>Next <var>ns</var> lines:</strong> all unique solutions as expressions without spaces</div>
   </div>
   <div class="blk">
      <div class="title">Constraints</div>
      <div class="question-statement-constraints">0 &lt;= <var>a</var>, <var>b</var>, <var>c</var>, <var>d</var> &lt;= 100</div>
   </div>
   <div class="blk">
      <div class="title">Example</div>
      <div class="statement-inout">
         <div class="statement-inout-in">
            <div class="title">Input</div>
            <pre class="question-statement-example-in">5 3 2 2</pre>
         </div>
         <div class="statement-inout-out">
            <div class="title">Output</div>
            <pre class="question-statement-example-out">1
3*(2*5-2)</pre>
         </div>
      </div>
   </div>
</div>